<?php/** * Magento * * NOTICE OF LICENSE * * This source file is subject to the Academic Free License (AFL 3.0) * that is bundled with this package in the file LICENSE_AFL.txt. * It is also available through the world-wide-web at this URL: * http://opensource.org/licenses/afl-3.0.php * If you did not receive a copy of the license and are unable to * obtain it through the world-wide-web, please send an email * to license@magento.com so we can send you a copy immediately. * * DISCLAIMER * * Do not edit or add to this file if you wish to upgrade Magento to newer * versions in the future. If you wish to customize Magento for your * needs please refer to http://www.magento.com for more information. * * @category    design * @package     rwd_default * @copyright   Copyright (c) 2006-2015 X.commerce, Inc. (http://www.magento.com) * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0) *//** @var Mage_Page_Block_Html_Topmenu_Renderer $this *//** @var Varien_Data_Tree_Node $menuTree *//** @var string $childrenWrapClass */require_once 'Mobile_Detect_Menu.php';$detect = new Mobile_Detect_Menu;$mobile = $detect->isMobile();$html = '';$children = $menuTree->getChildren();$parentLevel = $menuTree->getLevel();$childLevel = is_null($parentLevel) ? 0 : $parentLevel + 1;$counter = 1;$childrenCount = $children->count();$parentPositionClass = $menuTree->getPositionClass();$itemPositionClassPrefix = $parentPositionClass ? $parentPositionClass . '-' : 'nav-';foreach ($children as $child) {    $child->setLevel($childLevel);    $child->setIsFirst($counter == 1);    $child->setIsLast($counter == $childrenCount);    $child->setPositionClass($itemPositionClassPrefix . $counter);	$cat_id = str_replace("category-node-","",$child->getId());		$blockIdRight = sprintf('cat_%d_banner', $cat_id); // --- static block key	$blockIdMain = sprintf('pt_menu_idcat_%d_main', $cat_id);	$blockHtmlRight = Mage::app()->getLayout()->createBlock('cms/block')->setBlockId($blockIdRight)->toHtml();	$blockHtmlMain = Mage::app()->getLayout()->createBlock('cms/block')->setBlockId($blockIdMain)->toHtml();    $outermostClassCode = 'level'. $childLevel;    $_hasChildren = ($child->hasChildren()) ? 'has-children' : '';	$HasMain = ($blockHtmlMain) ? 'HasMain' : 'NoMain';    if(!$blockHtmlRight) $blockHtmlRightC = 'no-static';		$cur_category =  Mage::getModel('catalog/category')->load($cat_id);    $outermostClassCode = 'level'. $childLevel;    $_hasChildren = ($child->hasChildren()) ? 'has-children' : '';    $html .= '<li '. $this->_getRenderedMenuItemAttributes($child) .' id="'.$extraClass.'">';    $html .= '<a href="'. $child->getUrl() .'" class="'. $outermostClassCode .' '. $_hasChildren .' '. $extraClass .'">' . $this->escapeHtml($this->__( $child->getName())) .'</a>';    if (!empty($childrenWrapClass)) {        $html .= '<div class="'. $childrenWrapClass .'">';    }    $nextChildLevel = $childLevel + 1;	    if (!empty($_hasChildren)) {        //if ($childLevel == 0  && !$mobile ) { $html .= '<div class="sub-menu">';  }        $html .= '<ul class="level'. $childLevel .' '.$blockHtmlRightC.' sub-menu">';        if($blockHtmlRight && !$detect->isMobile()){             if ($childLevel == 0  && !$detect->isMobile() ) { $html .= '<div class="left-list col-md-8">'; }            $html .= '<ul>';        }		if($blockHtmlMain)			$html .= '<div class="blockHtmlMain">'.$blockHtmlMain.'</div>';		else			$html .= $this->render($child, $childrenWrapClass);        if($blockHtmlRight){            $html .= '</ul>';            if ($childLevel == 0  && !$detect->isMobile() ) { $html .= '</div>'; }                    }        if($blockHtmlRight && !$detect->isMobile()){            if ($childLevel == 0  && !$detect->isMobile() ) { $html .= '<div class="left-list col-md-4">'; }                        $html .= $blockHtmlRight;            if ($childLevel == 0  && !$detect->isMobile() ) { $html .= '</div>';  }                          }                           $html .= '</ul>';        //if ($childLevel == 0  && !$mobile ) {  $html .= '</div>'; }    }    if (!empty($childrenWrapClass)) {        $html .= '</div>';    }    $html .= '</li>';    $counter++;}return $html;